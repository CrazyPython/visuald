<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html lang='en-US'>

<!--
	Copyright (c) 1999-2010 by Digital Mars
	All Rights Reserved Written by Walter Bright
	http://www.digitalmars.com
  -->

<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" >
<title>C++ Conversion Wizard - D Programming Language - Digital Mars</title>
<link rel="stylesheet" type="text/css" href="../css/codemirror.css" />
<link rel="stylesheet" type="text/css" href="../css/style.css">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
<script src="/js/codemirror.js"></script>
<script src="/js/d.js"></script>
<script src="/js/run.js" type="text/javascript"></script>

</head>

<body class='hyphenate'>

<div id="top">
	<div id="search-box">
		<form method="get" action="http://google.com/search">
			<img src="/images/search-left.gif" width="11" height="22" alt=""><input id="q" name="q"><input type="image" id="search-submit" name="submit" src="/images/search-button.gif">
			<input type="hidden" id="domains" name="domains" value="dlang.org">
			<input type="hidden" id="sourceid" name="sourceid" value="google-search">
			<div id="search-dropdown">
				<select id="sitesearch" name="sitesearch" size="1">
					<option value="dlang.org">Entire D  Site</option>
					<option value="dlang.org/visuald">Visual D</option>
					<option value="www.digitalmars.com/d/archives">Newsgroup Archives</option>
				</select>
			</div>
		</form>
	</div>
	<div id="header">
		<a href="/"><img id="logo" width="125" height="95" border="0" alt="D Logo" src="../images/dlogo.png"></a>
		<a id="d-language" href="/">D Programming Language - Visual D</a>
	</div>
</div>

<div id="navigation">
    
<div class="navblock">
<form method="get" action="http://www.google.com/search">
<div id="searchbox">
<input name="q" size="10" value="Visual D" onFocus='if(this.value == "Visual D"){this.value="";}'>
<input type="hidden" name="domains" value="www.digitalmars.com">
<input type="hidden" name="sitesearch" value="dlang.org/visuald">
<input type="hidden" name="sourceid" value="google-search">
<input type="submit" name="submit" value="Go">
</div>
</form>
<div id="toctop">
    <ul><h2><a href="../index.html" title="D Programming Language">D</a></h2>
	<li><a href="../download.html" title="Download a D compiler">Downloads &amp; Tools</a></li>
	<li><a href="../spec.html" title="D Language Specification">Language</a></li>
	<li><a href="../phobos/index.html" title="D Runtime Library">Runtime Library </a></li>
    </ul>

</div>
</div>

    
<div class="navblock">
 <h2><a href="StartPage.html" title="Visual Studio Plugin for D">Visual D</a></h2>
 <ul>  <li><a href="Installation.html" title="Installation">Installation</a></li>
  <li><a href="Features.html" title="Visual D Features">Features</a>
   <ul>    <li><a href="GlobalOptions.html" title="Global Options">Global options</a></li>
    <li><a href="ProjectWizard.html" title="Project Wizard to create new projects">Project Wizard</a></li>
    <li><a href="Editor.html" title="Language support in the editor">Editor</a></li>
    <li><a href="Search.html" title="Search symbols and files">Search Window</a></li>
    <li><a href="TokenReplace.html" title="Token Search and Replace">Token Replace</a></li>
    <li><a href="ProjectConfig.html" title="Setting up build settings">Project Config</a></li>
    <li><a href="CppConversion.html" title="C++ to D Converter">C++ to D</a></li>
    <li><a href="Debugging.html" title="Debugger support">Debugging</a></li>
    <li><a href="Profiling.html" title="Profiler window">Profiling</a></li>
    <li><a href="BrowseInfo.html" title="Browse information">Browse Info</a></li>
   </ul>

  </li>
  <li><a href="VersionHistory.html" title="Latest changes">Version History</a></li>
  <li><a href="KnownIssues.html" title="Installation">Known Issues</a></li>
  <li><a href="BuildFromSource.html" title="Building from source">Building from Source</a></li>
 </ul>

</div>


<div class="navblock">
<h2>Community</h2>
<ul>	<li><a href="http://forum.dlang.org/" title="User forums">Forums</a></li>

	<li><a href="http://github.com/D-Programming-Language" title="D on github">GitHub</a></li>

	<li><a href="http://wiki.dlang.org" title="Wiki for the D Programming Language">Wiki</a></li>

	<li><a href="http://wiki.dlang.org/Review_Queue" title="Queue of current and upcoming standard library additions">Review Queue</a></li>

	<li><a href="http://twitter.com/#search?q=%23d_lang" title="#d_lang on twitter.com">Twitter</a></li>

</ul>

</div>


</div><!--/navigation-->
<div id="content">
    
<div id="tools">
	<!--span id="lastupdate">Last update </span-->
	<span class="tip">
		<a href="https://github.com/D-Programming-Language/visuald/edit/master/visuald\CppConversion.dd" class="button">Improve this page</a>
		<span>
			Quickly fork, edit online, and submit a pull request for this page.
			Requires a signed-in GitHub account. This works well for small changes.
			If you'd like to make larger changes you may want to consider using
			local clone.
		</span>
	</span>
	<span class="tip">
		<a href="http://wiki.dlang.org/DocComments/visuald" class="button">Page wiki</a>
		<span>
			View or edit the community-maintained wiki page associated with this page.
		</span>
	</span>
</div>

    <h1>C++ Conversion Wizard</h1>
    <div id=quickindex class=quickindex></div>
    <!-- Generated by Ddoc from visuald\CppConversion.dd -->


$(P Visual D can help you converting your C++ code base to D. Even though it is 
capable of some quite extensive reorganization of the code, don't expect to get 
compilable and runnable code out of the box. Helping the converter with additional
replacement rules and manual additional editing of the result might be necessary. 

<p>The conversion consists of a number of steps:</p>
<ul>    <li>convert text into a stream of tokens with preceding white space or comments</li>
    <li>convert/expand preprocessor directives, so that the text is no longer a mixture 
	  of two languages. Conditionals are replaced by constructs that should fit into a 
	  tree hierarchy similar to "static if" in D.</li>
    <li>apply user specified replacement rules (pre)</li>
    <li>parse the text with a (slightly sloppy) C++ parser into a syntax tree</li>
    <li>perform a number of transformations on the tree</li>
    <li>apply user specified replacement rules (post)</li>
    <li>write output including adding a prefix to D keywords that are not C++ keywords</li>
</ul>


<p>You can invoke the C++ conversion wizard from the Visual D menu.</p>

<div align="center"><img src="images/cppwizard.png" /></div>


<p>Options:</p>
<ul>    <li>Convert: Input files/Current document/Current selection. When selecting 
	  "Input files", a whole source code base can be converted, writing files to 
	  the output directory. Otherwise, the text in the editor is replaced. If you
	  have not changed the text and selection after the last conversion, redoing 
	  the conversion will use the initial code to better allow tweaking options.</li>

    <li>Input dir: base directory of input file specifications</li>
    <li>Files and directories: filename pattern to include into conversion, prefix 
	  with '+' to recurse into subdirectories, prefix with '-' to exclude files from
	  the list of files specified so far.</li>
    <li>Source code header: header to write into output files. The identifier 
	  MODULENAME is replaced with the module name of the generated D file. If it
	  is not specified in the header, a module statement will be prepended to it.</li>
    <li>Output dir: the directory where to write output files to.</li>
    <li>Write intermediate files: To debug problems during the conversion, 
	  intermediate files can be written to sub directories "pass1" (after the 
	  proprocessor handling) and "pass2" (after the code reorganization, but 
	  before the final replacements).</li>
    <li>Preprocessor expansions: only the preprocessor identifiers given here 
	  will be expanded. All other preprocessor directives are translated to 
	  corresponding D code. If no assignment is given, the first definition within 
	  the input source code is used. If preprocessor conditionals are expanded, only 
	  the active code path is written to the output file.</li>
    <li>Version conditionals: normally, preprocessor conditionals are translated 
	  to "static if" conditions, but if an identifier is specified here, version 
	  conditionals are used.</li>
    <li>Pre and post token replacements: some constructs are not parsable or 
	  don't convert well. With the token replacements you can inject some replacement 
	  rules into the conversion process. The replacement follows the <a href="TokenReplace.html
	  Token Search and Replace"></a>
 functionality. The syntax of the rule is
	 <pre>[filename-pattern::] search-pattern =&gt; replacement </pre>

	 If you want to span the rule across multiple lines, use the \ line splicing mechanism.
	</li>
    <li>Value/reference types: sometimes the parser or the converter stumbles across 
	  unknown identifiers that might be types. You can help it specifying them here.
	  Value or reference semantics determine whether an indirection is removed from
	  pointer declarations.</li>
    <li>Keyword prefix: identifiers that are keywords in D, but not in C++, are 
	  prefixed with the given text.</li>
    <li>Package prefix: module names are prefixed with the given package identifier</li>
    <li>Load/Save: save and restore the current dialog settings</li>
    <li>Convert: start the conversion</li>
</ul>


<p>When using the converter on the current selection (there is also a command 
VisualD.ConvertSelection that you can assign to a keyboard shortcut) you should 
select complete declarations, e.g. variable or class declarations and functions. 
Otherwise the parser will stumble.</p>

<p>This tool is the result of generalizing an attempt to convert the dmd front 
end code to D, so please don't be surprised to find some unexpected special casings 
from time to time. The result of that attempt was that the converted code was 
parsable, but did not pass all semantic stages.</p>

<h2>Running from the console</h2>

<p>There is also a command line version of this wizard available 
in the downloads folder: 
<a href="http://www.dsource.org/projects/visuald/browser/downloads/cpp2d.exe?format=raw">cpp2d.exe</a>
</p>

<p>You can pass a config file to the converter that has been saved by the wizard dialog.
<pre>cpp2d -config myoptions.c2d [files-specs...]</pre>

If you pass files to the program, file specifications in the configuration file are ignored.</p>

<p>See <a href="http://www.dsource.org/projects/visuald/browser/trunk/c2d/dmd.c2d">here</a>
 
for an example of a configuration file to get started on converting the dmd front end.</p>

<h2>Examples</h2>

<p>Here are some examples of what the converter can do for you:</p>

Move member and field implementation into class declaration.

<div align="center">
<table width="90%" style="border: 1px solid #ccc;margin: 0 0 0em 0em;" bgcolor="#F0F0F0">
<tr bgcolor="#C0C0C0"><th>C++</th><th>D</th></tr>
<tr><td width="45%" bgcolor="#FFF0F0"><pre style="background-color: #FFF0F0; border: 0px;margin: 0 0 0em 0em;">
class C {
  // comments are usually kept
  static int x;
  DECL *foo(int flags = 0);
};

</pre></td><td width="45%" bgcolor="#F0F0FF"><pre style="background-color: #F0F0FF; border: 0px;margin: 0 0 0em 0em;">

struct C {
  // comments are usually kept
  static int x = 3;
  // moved with the implementation
 DECL *foo(int flags = 0) { return null; }
};

</pre></td></tr>
</table>
</div>


Convert constructor and call super constructor

<div align="center">
<table width="90%" style="border: 1px solid #ccc;margin: 0 0 0em 0em;" bgcolor="#F0F0F0">
<tr bgcolor="#C0C0C0"><th>C++</th><th>D</th></tr>
<tr><td width="45%" bgcolor="#FFF0F0"><pre style="background-color: #FFF0F0; border: 0px;margin: 0 0 0em 0em;">
struct A : B {
    A() : B(1) { }
    A(int x) : B(x) { }
};

</pre></td><td width="45%" bgcolor="#F0F0FF"><pre style="background-color: #F0F0FF; border: 0px;margin: 0 0 0em 0em;">

class A : B {
    this() { super(1); }
    this(int x) { super(x); }
};

</pre></td></tr>
</table>
</div>

Split declarations for variables with different types

<div align="center">
<table width="90%" style="border: 1px solid #ccc;margin: 0 0 0em 0em;" bgcolor="#F0F0F0">
<tr bgcolor="#C0C0C0"><th>C++</th><th>D</th></tr>
<tr><td width="45%" bgcolor="#FFF0F0"><pre style="background-color: #FFF0F0; border: 0px;margin: 0 0 0em 0em;">
int a = sizeof(void *);
int x, *y = (int*)null;

</pre></td><td width="45%" bgcolor="#F0F0FF"><pre style="background-color: #F0F0FF; border: 0px;margin: 0 0 0em 0em;">

int a = (void *).sizeof;
int x;
int *y = cast(int *)null;

</pre></td></tr>
</table>
</div>

Add enumerator type to constants of named enumerator values

<div align="center">
<table width="90%" style="border: 1px solid #ccc;margin: 0 0 0em 0em;" bgcolor="#F0F0F0">
<tr bgcolor="#C0C0C0"><th>C++</th><th>D</th></tr>
<tr><td width="45%" bgcolor="#FFF0F0"><pre style="background-color: #FFF0F0; border: 0px;margin: 0 0 0em 0em;">
typedef enum { e1, e2 } EX;
enum ENUM { kEnum };
int foo() {
    Ident id = (op == kEnum) ? 0 : 1;
}

</pre></td><td width="45%" bgcolor="#F0F0FF"><pre style="background-color: #F0F0FF; border: 0px;margin: 0 0 0em 0em;">

 enum unnamed_1 { e1$_j e2 }alias unnamed_1 EX;
enum ENUM { kEnum };
int foo() {
    Ident id = (op == ENUM.kEnum) ? 0 : 1;
}

</pre></td></tr>
</table>
</div>

Simple template translations

<div align="center">
<table width="90%" style="border: 1px solid #ccc;margin: 0 0 0em 0em;" bgcolor="#F0F0F0">
<tr bgcolor="#C0C0C0"><th>C++</th><th>D</th></tr>
<tr><td width="45%" bgcolor="#FFF0F0"><pre style="background-color: #FFF0F0; border: 0px;margin: 0 0 0em 0em;">
template&lt;typename TYPE&gt;
struct ArrayBase : Array { 
    TYPE* data;
};
template&lt;typename S$_j class T&gt;
double foo(S s$_j T t) { return s+t; }

</pre></td><td width="45%" bgcolor="#F0F0FF"><pre style="background-color: #F0F0FF; border: 0px;margin: 0 0 0em 0em;">

class ArrayBase( TYPE) : Array { 
    TYPE* data;
};

double foo( S$_j T)(S s$_j T t) { return s+t; }

</pre></td></tr>
</table>
</div>

Preprocessor macros are converted to enum, alias or templates

<div align="center">
<table width="90%" style="border: 1px solid #ccc;margin: 0 0 0em 0em;" bgcolor="#F0F0F0">
<tr bgcolor="#C0C0C0"><th>C++</th><th>D</th></tr>
<tr><td width="45%" bgcolor="#FFF0F0"><pre style="background-color: #FFF0F0; border: 0px;margin: 0 0 0em 0em;">
#define K1 1 // keep comment
#define K2 (K1+K1)
#define K3 K1
#define SQR(n) (n)*(n)

</pre></td><td width="45%" bgcolor="#F0F0FF"><pre style="background-color: #F0F0FF; border: 0px;margin: 0 0 0em 0em;">

enum K1 =  1; // keep comment
enum K2 =  (K1+K1);
alias K3 K1;
 auto SQR( ARG1 )(ARG1 n) { return  n*n; }

</pre></td></tr>
</table>
</div>

Preprocessor conditionals are converted to static if or can be removed when specified in the "expansions" field

<div align="center">
<table width="90%" style="border: 1px solid #ccc;margin: 0 0 0em 0em;" bgcolor="#F0F0F0">
<tr bgcolor="#C0C0C0"><th>C++</th><th>D</th></tr>
<tr><td width="45%" bgcolor="#FFF0F0"><pre style="background-color: #FFF0F0; border: 0px;margin: 0 0 0em 0em;">
#define ABC 1
  a = 1;
#if ABC
  b = 2;
#endif
  c = 3;

</pre></td><td width="45%" bgcolor="#F0F0FF"><pre style="background-color: #F0F0FF; border: 0px;margin: 0 0 0em 0em;">

enum ABC = 1;
  a = 1;
static if(ABC) {
  b = 2;
}
  c = 3;

</pre></td></tr>
</table>
</div>


It can deal with a number of complicated uses of preprocessor conditionals, but they can get much more difficult to read.

<div align="center">
<table width="90%" style="border: 1px solid #ccc;margin: 0 0 0em 0em;" bgcolor="#F0F0F0">
<tr bgcolor="#C0C0C0"><th>C++</th><th>D</th></tr>
<tr><td width="45%" bgcolor="#FFF0F0"><pre style="background-color: #FFF0F0; border: 0px;margin: 0 0 0em 0em;">
void foo(x) {
  if (x)
    c = 0;
#if COND1 // comment
  else if (a)
#elif COND2
  else if (b)
#endif
    c = 1;
}

</pre></td><td width="45%" bgcolor="#F0F0FF"><pre style="background-color: #F0F0FF; border: 0px;margin: 0 0 0em 0em;">

void foo(x) {
  if (x)
    c = 0;
else if(true) static if(COND1) // comment
  /*else*/ if (a)
goto L_T4; else goto L_F4; else static if(COND2)
  /*else*/ if (b)
goto L_T4; else goto L_F4; else goto L_T4; else L_F4: if(0) L_T4:
    c = 1;
}

</pre></td></tr>
</table>
</div>


    
<br><br>
<br><br>
<!-- Google ad -->
<script type="text/javascript"><!--
/**/google_ad_client = "pub-5628673096434613";
/**/google_ad_width = 728;
/**/google_ad_height = 90;
/**/google_ad_format = "728x90_as";
/**/google_ad_channel ="6203743411";
/**/google_page_url = document.location;
//--></script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>

</div><!--/content-->


<div id="copyright">
Copyright &copy; 1999-2013 by Digital Mars, All Rights Reserved
 |
Page generated by <a href="http://www.digitalmars.com/d/2.0/ddoc.html">Ddoc</a>
.
</div>

</body>
</html>

